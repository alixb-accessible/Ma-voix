<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Parole</title>
    <link rel="stylesheet" href="https://alixb-accessible.github.io/faites-mieux-toolbar/faites-mieux.css">
    <script src="https://alixb-accessible.github.io/faites-mieux-toolbar/faites-mieux.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, 
                #4a4a4a 0%, #4a4a4a 14.28%,
                #22c55e 14.28%, #22c55e 28.56%,
                #3b82f6 28.56%, #3b82f6 42.84%,
                #ffffff 42.84%, #ffffff 57.12%,
                #fbbf24 57.12%, #fbbf24 71.4%,
                #dc2626 71.4%, #dc2626 85.68%,
                #4a4a4a 85.68%, #4a4a4a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
            font-size: 1.1em;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .controls > div {
            width: 100%;
        }

        select {
            width: 100%;
            padding: 18px 50px 18px 15px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 18px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 24px;
            touch-action: manipulation;
        }

        select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        optgroup {
            font-weight: bold;
            font-size: 17px;
            color: #1f2937;
            padding: 10px 0;
            background: #f3f4f6;
        }

        option {
            padding: 12px;
            font-size: 17px;
            background: white;
            color: #1f2937;
        }
.buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            min-width: 140px;
            padding: 18px 30px;
            font-size: 19px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            min-height: 60px;
        }

        .btn-speak {
            background: #22c55e;
            color: white;
        }

        .btn-speak:hover {
            background: #16a34a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(34, 197, 94, 0.4);
        }

        .btn-speak:active {
            background: #16a34a;
            transform: scale(0.98);
        }

        .btn-speak:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-stop {
            background: #dc2626;
            color: white;
        }

        .btn-stop:hover {
            background: #b91c1c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.4);
        }

        .btn-stop:active {
            background: #b91c1c;
            transform: scale(0.98);
        }

        .btn-stop:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-clear {
            background: #6b7280;
            color: white;
        }

        .btn-clear:hover {
            background: #4b5563;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 114, 128, 0.4);
        }

        .btn-clear:active {
            background: #4b5563;
            transform: scale(0.98);
        }

        .status {
            text-align: center;
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
        }

        .status.speaking {
            background: #dcfce7;
            color: #166534;
        }

        .status.idle {
            background: #f3f4f6;
            color: #6b7280;
        }

        .history-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 3px solid #e5e7eb;
        }

        .history-section h2 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .history-container {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-text {
            color: #1f2937;
            margin-bottom: 10px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .history-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .history-btn {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
        }

        .history-btn-play {
            background: #22c55e;
            color: white;
        }

        .history-btn-play:hover {
            background: #16a34a;
        }

        .history-btn-copy {
            background: #6b7280;
            color: white;
        }

        .history-btn-copy:hover {
            background: #4b5563;
        }

        .history-btn-delete {
            background: #ef4444;
            color: white;
        }

        .history-btn-delete:hover {
            background: #dc2626;
        }

        .history-empty {
            text-align: center;
            color: #9ca3af;
            padding: 30px;
            font-style: italic;
        }

        .clear-history-btn {
            margin-top: 15px;
            width: 100%;
            padding: 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-history-btn:hover {
            background: #dc2626;
        }
.quick-phrases-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 3px solid #e5e7eb;
        }

        .quick-phrases-section h2 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .quick-phrases-container {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .quick-phrase-item {
            background: white;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #22c55e;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-phrase-item:hover {
            background: #f0fdf4;
        }

        .quick-phrase-item:last-child {
            margin-bottom: 0;
        }

        .quick-phrase-text {
            color: #1f2937;
            font-weight: 500;
        }

        .quick-phrase-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-phrase-btn {
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            flex: 1;
            min-width: 100px;
        }

        .quick-phrase-btn-use {
            background: #22c55e;
            color: white;
        }

        .quick-phrase-btn-use:hover {
            background: #16a34a;
        }

        .quick-phrase-btn-read {
            background: #3b82f6;
            color: white;
        }

        .quick-phrase-btn-read:hover {
            background: #2563eb;
        }

        .quick-phrase-btn-delete {
            background: #ef4444;
            color: white;
            flex: 0;
            min-width: auto;
        }

        .quick-phrase-btn-delete:hover {
            background: #dc2626;
        }

        .quick-phrase-help {
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .add-quick-phrase-btn {
            width: 100%;
            padding: 12px;
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
        }

        .add-quick-phrase-btn:hover {
            background: #16a34a;
        }

        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 1.5em;
            }

            textarea {
                font-size: 17px;
                padding: 15px;
            }

            select {
                font-size: 17px;
                padding: 16px 50px 16px 15px;
                min-height: 56px;
            }

            option, optgroup {
                font-size: 16px;
            }

            button {
                min-width: 100%;
                font-size: 18px;
                padding: 18px 20px;
                min-height: 60px;
            }

            .buttons {
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Assistant Parole</h1>
        
        <div class="input-group">
            <label for="textInput">Écrivez votre texte ici :</label>
            <textarea 
                id="textInput" 
                placeholder="Tapez le texte que vous voulez entendre..."
                aria-label="Zone de texte pour la synthèse vocale"
            >Bonjour ! Je suis votre assistant parole. Écrivez quelque chose et je le lirai pour vous.</textarea>
        </div>

        <div class="controls">
            <div>
                <label for="voiceSelect">Voix :</label>
                <select id="voiceSelect" aria-label="Sélection de la voix"></select>
            </div>
            <div>
                <label for="rateSelect">Vitesse :</label>
                <select id="rateSelect" aria-label="Sélection de la vitesse">
                    <option value="0.5">Très lent</option>
                    <option value="0.6">Batman (Lent et menaçant)</option>
                    <option value="0.75">Lent</option>
                    <option value="1" selected>Normal</option>
                    <option value="1.25">Rapide</option>
                    <option value="1.5">Très rapide</option>
                </select>
            </div>
            <div>
                <label for="pitchSelect">Hauteur :</label>
                <select id="pitchSelect" aria-label="Sélection de la hauteur de la voix">
                    <option value="0.5">Batman (Ultra grave)</option>
                    <option value="0.6">Très très grave</option>
                    <option value="0.75">Grave</option>
                    <option value="1" selected>Normal</option>
                    <option value="1.25">Aigu</option>
                    <option value="1.5">Très aigu</option>
                    <option value="2">Très très aigu</option>
                </select>
            </div>
        </div>

        <div class="buttons">
            <button class="btn-speak" id="speakBtn" aria-label="Lire le texte">
                Lire
            </button>
            <button class="btn-stop" id="stopBtn" disabled aria-label="Arrêter la lecture">
                Stop
            </button>
            <button class="btn-clear" id="clearBtn" aria-label="Effacer le texte">
                Effacer
            </button>
        </div>

        <div class="status idle" id="status" role="status" aria-live="polite">
            Prêt à lire
        </div>

        <div class="quick-phrases-section">
            <h2>Phrases rapides</h2>
            <div class="quick-phrase-help">
                Utilisez les boutons ci-dessous pour chaque phrase
            </div>
            <div class="quick-phrases-container" id="quickPhrasesContainer">
            </div>
            <button class="add-quick-phrase-btn" id="addQuickPhraseBtn">
                Ajouter la phrase actuelle aux phrases rapides
            </button>
        </div>

        <div class="history-section">
            <h2>Historique des phrases</h2>
            <div class="history-container" id="historyContainer">
                <div class="history-empty">
                    Aucune phrase dans l'historique. Les phrases lues apparaîtront ici.
                </div>
            </div>
            <button class="clear-history-btn" id="clearHistoryBtn" style="display: none;">
                Effacer tout l'historique
            </button>
        </div>
    </div>

    <script>
const textInput = document.getElementById('textInput');
        const voiceSelect = document.getElementById('voiceSelect');
        const rateSelect = document.getElementById('rateSelect');
        const pitchSelect = document.getElementById('pitchSelect');
        const speakBtn = document.getElementById('speakBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const status = document.getElementById('status');
        const historyContainer = document.getElementById('historyContainer');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const quickPhrasesContainer = document.getElementById('quickPhrasesContainer');
        const addQuickPhraseBtn = document.getElementById('addQuickPhraseBtn');

        let voices = [];
        let synthesis = window.speechSynthesis;
        let history = [];
        let quickPhrases = [];

        // Phrases rapides par défaut
        const defaultQuickPhrases = [
            "Oui",
            "Non",
            "S'il vous plaît",
            "D'accord",
            "Pas d'accord",
            "Laissez-moi le temps d'écrire ce que je dois dire",
            "Soyez patient, je parle avec un assistant parole",
            "Merci de me laisser la parole",
            "Vous faites preuve d'inclusion en me laissant parler",
            "Ne raccrochez pas ! Je ne suis pas une IA, je parle avec une machine",
            "Ne soyez pas validiste !"
        ];

        // Charger les voix disponibles
        function loadVoices() {
            voices = synthesis.getVoices();
            voiceSelect.innerHTML = '';
            
            const frenchVoices = voices.filter(v => v.lang.startsWith('fr'));
            const maleVoices = frenchVoices.filter(v => 
                v.name.toLowerCase().includes('male') || 
                v.name.toLowerCase().includes('homme') ||
                v.name.toLowerCase().includes('thomas') ||
                v.name.toLowerCase().includes('daniel') ||
                v.name.toLowerCase().includes('paul') ||
                v.name.toLowerCase().includes('henri') ||
                v.name.toLowerCase().includes('alain') ||
                v.name.toLowerCase().includes('claude') ||
                v.name.toLowerCase().includes('jerome') ||
                v.name.toLowerCase().includes('maurice')
            );
            const femaleVoices = frenchVoices.filter(v => 
                v.name.toLowerCase().includes('female') || 
                v.name.toLowerCase().includes('femme') ||
                v.name.toLowerCase().includes('amélie') ||
                v.name.toLowerCase().includes('marie') ||
                v.name.toLowerCase().includes('céline') ||
                v.name.toLowerCase().includes('denise') ||
                v.name.toLowerCase().includes('eloise') ||
                v.name.toLowerCase().includes('brigitte') ||
                v.name.toLowerCase().includes('hortense')
            );
            const otherFrenchVoices = frenchVoices.filter(v => 
                !maleVoices.includes(v) && !femaleVoices.includes(v)
            );
            const nonFrenchVoices = voices.filter(v => !v.lang.startsWith('fr'));
            
            if (femaleVoices.length > 0) {
                const femaleGroup = document.createElement('optgroup');
                femaleGroup.label = 'Voix féminines françaises';
                femaleVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voices.indexOf(voice);
                    option.textContent = `${voice.name}`;
                    femaleGroup.appendChild(option);
                });
                voiceSelect.appendChild(femaleGroup);
            }
            
            if (maleVoices.length > 0) {
                const maleGroup = document.createElement('optgroup');
                maleGroup.label = 'Voix masculines françaises';
                maleVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voices.indexOf(voice);
                    option.textContent = `${voice.name}`;
                    maleGroup.appendChild(option);
                });
                voiceSelect.appendChild(maleGroup);
            }
            
            if (otherFrenchVoices.length > 0) {
                const otherFrGroup = document.createElement('optgroup');
                otherFrGroup.label = 'Autres voix françaises';
                otherFrenchVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voices.indexOf(voice);
                    option.textContent = `${voice.name}`;
                    if (voice.default) option.selected = true;
                    otherFrGroup.appendChild(option);
                });
                voiceSelect.appendChild(otherFrGroup);
            }
            
            if (nonFrenchVoices.length > 0) {
                const otherGroup = document.createElement('optgroup');
                otherGroup.label = 'Autres langues';
                nonFrenchVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voices.indexOf(voice);
                    option.textContent = `${voice.name} (${voice.lang})`;
                    otherGroup.appendChild(option);
                });
                voiceSelect.appendChild(otherGroup);
            }
        }

        loadVoices();
        if (synthesis.onvoiceschanged !== undefined) {
            synthesis.onvoiceschanged = loadVoices;
        }
        setTimeout(loadVoices, 100);
        setTimeout(loadVoices, 500);
// Charger les phrases rapides
        function loadQuickPhrases() {
            const storedData = {};
            for (let i = 0; i < 100; i++) {
                const key = `quickPhrase_${i}`;
                const value = localStorage.getItem(key);
                if (value) {
                    storedData[key] = value;
                }
            }
            
            if (Object.keys(storedData).length > 0) {
                quickPhrases = Object.values(storedData);
            } else {
                quickPhrases = [...defaultQuickPhrases];
                saveQuickPhrases();
            }
            
            renderQuickPhrases();
        }

        function saveQuickPhrases() {
            // Effacer les anciennes clés
            for (let i = 0; i < 100; i++) {
                localStorage.removeItem(`quickPhrase_${i}`);
            }
            
            // Sauvegarder les nouvelles
            quickPhrases.forEach((phrase, index) => {
                localStorage.setItem(`quickPhrase_${index}`, phrase);
            });
        }

        function renderQuickPhrases() {
            if (quickPhrases.length === 0) {
                quickPhrasesContainer.innerHTML = '<div class="history-empty">Aucune phrase rapide. Ajoutez-en avec le bouton ci-dessous.</div>';
                return;
            }

            let html = '';
            quickPhrases.forEach((phrase, index) => {
                const escapedText = phrase.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
                html += `
                    <div class="quick-phrase-item">
                        <div class="quick-phrase-text">${escapedText}</div>
                        <div class="quick-phrase-actions">
                            <button class="quick-phrase-btn quick-phrase-btn-use" onclick="useQuickPhrase(${index})">
                                Utiliser
                            </button>
                            <button class="quick-phrase-btn quick-phrase-btn-read" onclick="readQuickPhrase(${index})">
                                Lire
                            </button>
                            <button class="quick-phrase-btn quick-phrase-btn-delete" onclick="deleteQuickPhrase(${index})">
                                X
                            </button>
                        </div>
                    </div>
                `;
            });
            
            quickPhrasesContainer.innerHTML = html;
        }

        function useQuickPhrase(index) {
            const phrase = quickPhrases[index];
            if (phrase) {
                textInput.value = phrase;
                textInput.focus();
            }
        }

        function readQuickPhrase(index) {
            const phrase = quickPhrases[index];
            if (phrase) {
                textInput.value = phrase;
                speak();
            }
        }

        function deleteQuickPhrase(index) {
            if (confirm('Supprimer cette phrase rapide ?')) {
                quickPhrases.splice(index, 1);
                saveQuickPhrases();
                renderQuickPhrases();
            }
        }

        function addQuickPhrase() {
            const text = textInput.value.trim();
            if (!text) {
                alert('Veuillez entrer du texte avant de l\'ajouter aux phrases rapides.');
                return;
            }
            
            if (quickPhrases.includes(text)) {
                alert('Cette phrase existe déjà dans les phrases rapides.');
                return;
            }
            
            quickPhrases.push(text);
            saveQuickPhrases();
            renderQuickPhrases();
            
            const originalText = addQuickPhraseBtn.textContent;
            addQuickPhraseBtn.textContent = 'Phrase ajoutée !';
            setTimeout(() => {
                addQuickPhraseBtn.textContent = originalText;
            }, 2000);
        }

        loadQuickPhrases();
function speak() {
            const text = textInput.value.trim();
            
            if (!text) {
                alert('Veuillez entrer du texte à lire.');
                return;
            }

            addToHistory(text);
            synthesis.cancel();
            
            setTimeout(() => {
                speakText(text);
            }, 100);
        }

        function speakText(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            
            if (voices.length === 0) {
                voices = synthesis.getVoices();
            }
            
            const selectedVoice = voices[voiceSelect.value];
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            
            let pitchValue = parseFloat(pitchSelect.value);
            if (pitchValue < 0.5) {
                utterance.pitch = Math.max(0.5, pitchValue);
                utterance.rate = Math.min(parseFloat(rateSelect.value), parseFloat(rateSelect.value) * 0.8);
            } else {
                utterance.pitch = pitchValue;
                utterance.rate = parseFloat(rateSelect.value);
            }
            
            utterance.volume = 1;
            utterance.lang = selectedVoice ? selectedVoice.lang : 'fr-FR';
            
            utterance.onstart = () => {
                status.textContent = 'Lecture en cours...';
                status.className = 'status speaking';
                speakBtn.disabled = true;
                stopBtn.disabled = false;
            };
            
            utterance.onend = () => {
                status.textContent = 'Lecture terminée';
                status.className = 'status idle';
                speakBtn.disabled = false;
                stopBtn.disabled = true;
            };
            
            utterance.onerror = (e) => {
                let errorMsg = 'Erreur de lecture';
                if (e.error === 'canceled') errorMsg = 'Lecture annulée';
                else if (e.error === 'interrupted') errorMsg = 'Lecture interrompue';
                else if (e.error === 'audio-busy') errorMsg = 'Audio occupé';
                else if (e.error === 'not-allowed') errorMsg = 'Autorisations manquantes';
                else if (e.error === 'network') errorMsg = 'Erreur réseau';
                else errorMsg = 'Erreur: ' + e.error;
                
                status.textContent = errorMsg;
                status.className = 'status idle';
                speakBtn.disabled = false;
                stopBtn.disabled = true;
            };

            try {
                synthesis.speak(utterance);
            } catch (err) {
                alert('Erreur de lecture. Essayez de recharger la page.');
            }
        }

        function stop() {
            synthesis.cancel();
            status.textContent = 'Lecture arrêtée';
            status.className = 'status idle';
            speakBtn.disabled = false;
            stopBtn.disabled = true;
        }

        function clear() {
            textInput.value = '';
            textInput.focus();
        }
function addToHistory(text) {
            const item = {
                id: Date.now(),
                text: text,
                timestamp: new Date().toLocaleString('fr-FR')
            };
            
            history.unshift(item);
            renderHistory();
        }

        function renderHistory() {
            if (history.length === 0) {
                historyContainer.innerHTML = '<div class="history-empty">Aucune phrase dans l\'historique. Les phrases lues apparaîtront ici.</div>';
                clearHistoryBtn.style.display = 'none';
                return;
            }

            clearHistoryBtn.style.display = 'block';
            
            let html = '';
            history.forEach(item => {
                const escapedText = item.text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
                html += `
                    <div class="history-item">
                        <div class="history-text">${escapedText}</div>
                        <div class="history-actions">
                            <button class="history-btn history-btn-play" onclick="playHistory(${item.id})">Relire</button>
                            <button class="history-btn history-btn-copy" onclick="copyHistory(${item.id})">Copier</button>
                            <button class="history-btn history-btn-delete" onclick="deleteHistory(${item.id})">Supprimer</button>
                        </div>
                    </div>
                `;
            });
            
            historyContainer.innerHTML = html;
        }

        function playHistory(id) {
            const item = history.find(h => h.id === id);
            if (item) {
                synthesis.cancel();
                setTimeout(() => {
                    speakText(item.text);
                }, 100);
            }
        }

        function copyHistory(id) {
            const item = history.find(h => h.id === id);
            if (item) {
                navigator.clipboard.writeText(item.text).then(() => {
                    alert('Texte copié !');
                }).catch(() => {
                    alert('Erreur lors de la copie');
                });
            }
        }

        function deleteHistory(id) {
            history = history.filter(h => h.id !== id);
            renderHistory();
        }

        function clearAllHistory() {
            if (confirm('Effacer tout l\'historique ?')) {
                history = [];
                renderHistory();
            }
        }

        // Événements des boutons principaux
        speakBtn.addEventListener('click', speak);
        stopBtn.addEventListener('click', stop);
        clearBtn.addEventListener('click', clear);
        addQuickPhraseBtn.addEventListener('click', addQuickPhrase);
        clearHistoryBtn.addEventListener('click', clearAllHistory);

        // Raccourci clavier Ctrl+Entrée pour lire
        textInput.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                speak();
            }
        });
    </script>
</body>
</html>

